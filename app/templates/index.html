{% extends "base.html" %} {% block title %}FoodFinder{% endblock %} {% block
content %}
<h1>Doporučené recepty</h1>
<p>Nechte se inspirovat naším výběřem</p>
<div
	class="row row-cols-1 row-cols-md-2 row-cols-lg-4 justify-content-center mb-4"
>
	{% for recipe in recipes_featured %} {% include "featured-card.html"%} {%
	endfor %}
</div>

<h1>Nejnovější recepty</h1>
<div id="recipe-list">
  {% for recipe in recipes %}
      {% include "recipe-card.html" %}
  {% endfor %}
</div>

<button id="load-more" class="load-more-button" data-page="1" {% if not next_page %}hidden{% endif %}>Načíst další</button>


<!--Load more button script-->
<script>
document.getElementById("load-more").addEventListener("click", function () {
    let button = this;
    let page = parseInt(button.getAttribute("data-page")) + 1;

    fetch(`/?page=${page}`)
        .then(response => response.text())  
        .then(data => {
            let parser = new DOMParser();
            let doc = parser.parseFromString(data, "text/html");
          
            let recipeList = document.getElementById("recipe-list");
            let newRecipes = doc.querySelectorAll(".recipe-card");
            newRecipes.forEach(recipe => {
                recipeList.appendChild(recipe);
            });
     
            button.setAttribute("data-page", page);
           
            if (!doc.querySelector("#load-more").hasAttribute("data-page")) {
                button.hidden = true;
            }
        })
        .catch(error => console.error("Chyba při načítání receptů:", error));
});
</script>


<!--Send client time script-->
<script>
  try {
    const now = new Date();
    let clientHour = now.getHours();

    if (isNaN(clientHour)) {
      throw new Error("Chybný čas");
    }

    fetch(`/?time=${clientHour}`, { method: "GET" })
      .then(response => response.text())
      .then(data => console.log(data))
      .catch(error => console.error("Chyba při odesílání času na server:", error));

  } catch (error) {
    console.warn("Nepodařilo se získat aktuální hodinu, používá se serverový čas.");
    fetch(`/?time=NaN`, { method: "GET" });
  }
</script>

<!--Button (načíst další) style-->
<style>
  .load-more-button {
	background-color: var(--gold-color);
	color: var(--black-color);
	border: 1px solid var(--dark-color);
	padding: 12px 24px;
	margin: 20px auto;
	display: block;
	cursor: pointer;
	border-radius: 5px;
	font-size: 1rem;
	font-weight: bold;
	text-align: center;
	transition: background-color 0.3s, color 0.3s;
}

.load-more-button:hover {
	background-color: var(--dark-gold-color);
	color: var(--gold-color);
}

</style>

{%endblock %}
